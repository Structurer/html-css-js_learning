<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ¬åœ°å“ˆå¸Œè®¡ç®—å·¥å…·ï¼ˆæ–‡æœ¬å®æ—¶+æ–‡ä»¶ç´¯åŠ  åˆ†æ å±•ç¤ºï¼‰</title>
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.2.0/crypto-js.min.js"></script>
    <style>
        * {margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif;}
        body {padding:20px;max-width:1600px;margin:0 auto;background:#f5f5f5;}
        .container {gap:20px;display:flex;flex-direction:column;}
        .title {text-align:center;color:#333;margin-bottom:10px;font-size:18px;}
        /* é€šç”¨å·¦å³å¹¶åˆ—å¸ƒå±€ */
        .row-box {display:flex;gap:20px;width:100%;}
        .col-box {flex:1;min-width:300px;}
        /* é€šç”¨æ¨¡å—å®¹å™¨ï¼šé«˜åº¦è‡ªé€‚åº”ä¸æº¢å‡º */
        .section {
            background:#fff;padding:18px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.1);
            display:flex;flex-direction:column;
        }
        .section h3 {color:#444;margin-bottom:12px;font-size:16px;border-bottom:1px solid #eee;padding-bottom:8px;}
        /* å·¦ä¾§æ–‡æœ¬è¾“å…¥ + å³ä¾§æ‹–æ‹½åŒº æ ·å¼ */
        #textInput {
            width:100%;padding:10px;border:1px solid #ddd;border-radius:4px;resize:vertical;font-size:14px;
            flex:1;min-height:120px;outline:none;
        }
        .drag-area {
            width:100%;border:2px dashed #ccc;border-radius:6px;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#666;cursor:pointer;transition:all 0.3s;
            flex:1;min-height:120px;
        }
        .drag-area.active {border-color:#2196F3;background:#f0f8ff;color:#2196F3;}
        .drag-area p {text-align:center;font-size:14px;line-height:1.5;}
        /* ç®—æ³•æ ï¼šç²¾ç®€5æ’ æ¸…ç©ºä¸é‡ç½® */
        .algo-wrap {margin-top:8px;}
        .algo-group {display:flex;flex-wrap:wrap;gap:12px;margin-bottom:10px;}
        .algo-item {display:flex;align-items:center;gap:4px;font-size:14px;}
        /* ğŸ”¥ æ”¹å›textarea å¤åŸå›ºå®šæœ€å°é«˜åº¦ï¼Œå†…å®¹æ»šåŠ¨ä¸æ‹‰ä¼¸ï¼Œæ’å¸ƒæ•´é½ */
        .result-box {
            width:100%;height:100%;min-height:300px;padding:10px;border:1px solid #ddd;border-radius:4px;resize:vertical;font-size:13px;line-height:1.6;
            background:#fafafa;white-space:pre-wrap;overflow-y:auto;flex:1;
        }
        /* æŒ‰é’®å±…ä¸­æ ¸å¿ƒæ ·å¼ */
        .btn-group {
            display:flex;gap:10px;margin-top:12px;
            justify-content:center;/* æŒ‰é’®æ°´å¹³å±…ä¸­ */
        }
        button {padding:8px 16px;border:none;border-radius:4px;background:#2196F3;color:#fff;cursor:pointer;font-size:14px;transition:background 0.2s;}
        button:hover {background:#1976D2;}
        button.clear {background:#f44336;}
        button.clear:hover {background:#d32f2f;}
        button.copy {background:#4CAF50;}
        button.copy:hover {background:#388E3C;}
        .loading {color:#2196F3;font-size:14px;text-align:center;display:none;margin-top:8px;}
        /* å“åº”å¼é€‚é…ï¼šå°å±å¹•è‡ªåŠ¨ä¸Šä¸‹å¸ƒå±€ï¼Œä¸æŒ¤ä¹± */
        @media (max-width:768px) {
            .row-box {flex-direction:column;}
            .col-box {min-width:unset;}
        }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="title">æœ¬åœ°å“ˆå¸Œè®¡ç®—å·¥å…·ï¼ˆæ–‡æœ¬å®æ—¶è®¡ç®— | æ–‡ä»¶æ‹–æ‹½ç´¯åŠ  | ç»“æœåˆ†æ å±•ç¤ºï¼‰</h2>

        <!-- 1. é¡¶éƒ¨å·¦å³åˆ†æ ï¼šå·¦=æ–‡æœ¬è¾“å…¥ï¼ˆå®æ—¶ç®—ï¼‰ å³=æ–‡ä»¶æ‹–æ‹½ï¼ˆç´¯åŠ ç®—ï¼‰ -->
        <div class="row-box">
            <div class="col-box">
                <div class="section">
                    <h3>ä¸€ã€ æ–‡æœ¬å“ˆå¸Œè¾“å…¥ï¼ˆå®æ—¶è®¡ç®—ï¼Œè¾“å…¥å³æ›´ï¼‰</h3>
                    <textarea id="textInput" placeholder="è¾“å…¥/ä¿®æ”¹æ–‡å­—å®æ—¶è®¡ç®—å“ˆå¸Œï¼Œå·¦åˆ—å®æ—¶æ›´æ–°è¦†ç›–æ—§ç»“æœ..."></textarea>
                </div>
            </div>
            <div class="col-box">
                <div class="section">
                    <h3>äºŒã€ æ‹–æ‹½æ–‡ä»¶/æ–‡ä»¶å¤¹ï¼ˆè‡ªåŠ¨ç´¯åŠ ï¼Œæ‹–æ‹½å³ç®—ï¼‰</h3>
                    <div id="dragArea" class="drag-area">
                        <p>ğŸ–±ï¸ æ‹–æ‹½æ–‡ä»¶/æ–‡ä»¶å¤¹è‡³æ­¤</p>
                        <p>å¤šæ‰¹æ¬¡æ‹–æ‹½ç´¯åŠ  | é€’å½’å­æ–‡ä»¶å¤¹ | å³åˆ—é¡ºåºæ’åˆ—ä¸æ‰“ä¹±</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. å“ˆå¸Œç®—æ³•é€‰æ‹©ï¼šå…¨å±€é€šç”¨ï¼Œæ¸…ç©ºä¸é‡ç½®å‹¾é€‰ -->
        <div class="section">
            <h3>ä¸‰ã€ é€‰æ‹©å“ˆå¸Œç®—æ³•ï¼ˆå…¨å±€é€šç”¨ï¼Œå¯å¤šé€‰ï¼‰</h3>
            <div class="algo-wrap">
                <div class="algo-group"><label class="algo-item"><input type="checkbox" name="algo" value="MD5" checked> MD5</label></div>
                <div class="algo-group"><label class="algo-item"><input type="checkbox" name="algo" value="SHA-1"> SHA-1</label></div>
                <div class="algo-group">
                    <label class="algo-item"><input type="checkbox" name="algo" value="SHA-256" checked> SHA-256</label>
                    <label class="algo-item"><input type="checkbox" name="algo" value="SHA-384"> SHA-384</label>
                    <label class="algo-item"><input type="checkbox" name="algo" value="SHA-512" checked> SHA-512</label>
                </div>
                <div class="algo-group">
                    <label class="algo-item"><input type="checkbox" name="algo" value="SHA-3-224"> SHA3-224</label>
                    <label class="algo-item"><input type="checkbox" name="algo" value="SHA-3-256"> SHA3-256</label>
                    <label class="algo-item"><input type="checkbox" name="algo" value="SHA-3-384"> SHA3-384</label>
                    <label class="algo-item"><input type="checkbox" name="algo" value="SHA-3-512"> SHA3-512</label>
                </div>
                <div class="algo-group"><label class="algo-item"><input type="checkbox" name="algo" value="RIPEMD-160"> RIPEMD-160</label></div>
            </div>
        </div>

        <!-- 3. æ“ä½œæŒ‰é’®ï¼šå±…ä¸­å¯¹é½ -->
        <div class="btn-group">
            <button id="copyAllBtn" class="copy">å¤åˆ¶å…¨éƒ¨ç»“æœ</button>
            <button id="clearAllBtn" class="clear">æ¸…ç©ºæ‰€æœ‰å†…å®¹</button>
        </div>
        <div class="loading" id="loading">è®¡ç®—ä¸­... å¤§æ–‡ä»¶/å¤šæ–‡ä»¶è¯·ç¨å€™</div>

        <!-- 4. ç»“æœåŒºï¼šæ”¹å›textarea å›ºå®šæœ€å°é«˜åº¦ï¼Œä¸æ‹‰ä¼¸ä¸ä¹±æ’ï¼ˆæ ¸å¿ƒå¤åŸï¼‰ -->
        <div class="row-box">
            <div class="col-box">
                <div class="section">
                    <h3>å››ã€ æ–‡æœ¬å“ˆå¸Œç»“æœï¼ˆå®æ—¶è¦†ç›–ï¼Œä»…å½“å‰æ–‡æœ¬ï¼‰</h3>
                    <textarea id="textResult" class="result-box" readonly placeholder="æ–‡æœ¬å“ˆå¸Œç»“æœå°†å®æ—¶å±•ç¤ºåœ¨è¿™é‡Œ..."></textarea>
                </div>
            </div>
            <div class="col-box">
                <div class="section">
                    <h3>äº”ã€ æ–‡ä»¶å“ˆå¸Œç»“æœï¼ˆæ‹–æ‹½ç´¯åŠ ï¼Œé¡ºåºæ’åˆ—ï¼‰</h3>
                    <textarea id="fileResult" class="result-box" readonly placeholder="æ–‡ä»¶å“ˆå¸Œç»“æœå°†æŒ‰æ‹–æ‹½é¡ºåºç´¯åŠ å±•ç¤ºåœ¨è¿™é‡Œ..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€DOMè·å–ï¼šå…¨å¤åŸæœ€åˆé…ç½®
        const textInput = document.getElementById('textInput');
        const dragArea = document.getElementById('dragArea');
        const textResult = document.getElementById('textResult');
        const fileResult = document.getElementById('fileResult');
        const copyAllBtn = document.getElementById('copyAllBtn');
        const clearAllBtn = document.getElementById('clearAllBtn');
        const loading = document.getElementById('loading');
        const algoCheckboxes = document.querySelectorAll('input[name="algo"]');
        let fileList = []; // æ–‡ä»¶åˆ—è¡¨ï¼šç´¯åŠ ä¸æ¸…é™¤ï¼ˆæ ¸å¿ƒï¼‰
        let newFileCount = 0; // ç²¾å‡†ç»Ÿè®¡æ¯æ¬¡æ‹–æ‹½çš„çœŸå®æ–‡ä»¶æ€»æ•°

        // 1. å…¨å±€é˜»æ­¢æ‹–æ‹½é»˜è®¤è¡Œä¸ºï¼Œä»…æ‹–æ‹½æ¡†ç”Ÿæ•ˆï¼Œåˆ«å¤„æ— ååº”
        document.addEventListener('dragover', (e) => e.preventDefault());
        document.addEventListener('drop', (e) => e.preventDefault());

        // ========== åŸç”Ÿå¼¹çª—3ç§’è‡ªåŠ¨å…³é—­ æ— éœ€ç¡®è®¤ï¼ˆä¿ç•™éœ€æ±‚2ï¼‰ ==========
        function autoCloseAlert(msg) {
            const alertWin = window.alert(msg);
            setTimeout(() => {
                const alertModal = document.querySelector('dialog[open]');
                if (alertModal && alertModal.close()) alertModal.close();
                window.focus();
            }, 3000);
            return alertWin;
        }

        // ========== æ ¸å¿ƒé€šç”¨å·¥å…·å‡½æ•° ==========
        // 1. è·å–å…¨å±€é€‰ä¸­çš„ç®—æ³•ï¼ˆé€šç”¨ï¼‰
        function getSelectedAlgos() {
            const selected = Array.from(algoCheckboxes).filter(box => box.checked).map(box => box.value);
            return selected.length > 0 ? selected : ['MD5', 'SHA-256', 'SHA-512']; // é»˜è®¤é€‰ä¸­å¸¸ç”¨ç®—æ³•
        }

        // ğŸ”¥ æ ¸å¿ƒä¿®æ”¹1ï¼šæ”¹å›textareaå…¼å®¹æ ¼å¼ + æ€è·¯1â– å…¨è§’å‰ç¼€ï¼Œé†’ç›®ä¸æ‚ä¹±ï¼Œæ ¼å¼ä¸å˜
        function calcSingleHash(data, isText = true) {
            const algos = getSelectedAlgos();
            let hashResult = '';
            // æ–‡æœ¬=ç›´æ¥ä¼ å­—ç¬¦ä¸²ï¼Œæ–‡ä»¶=ä¼ WordArrayäºŒè¿›åˆ¶
            const targetData = isText ? data : CryptoJS.lib.WordArray.create(data);
            algos.forEach((algo, index) => {
                let hash = '';
                switch(algo) {
                    case 'MD5': hash = CryptoJS.MD5(targetData).toString(); break;
                    case 'SHA-1': hash = CryptoJS.SHA1(targetData).toString(); break;
                    case 'SHA-256': hash = CryptoJS.SHA256(targetData).toString(); break;
                    case 'SHA-384': hash = CryptoJS.SHA384(targetData).toString(); break;
                    case 'SHA-512': hash = CryptoJS.SHA512(targetData).toString(); break;
                    case 'SHA-3-224': hash = CryptoJS.SHA3(targetData, { outputLength: 224 }).toString(); break;
                    case 'SHA-3-256': hash = CryptoJS.SHA3(targetData, { outputLength: 256 }).toString(); break;
                    case 'SHA-3-384': hash = CryptoJS.SHA3(targetData, { outputLength: 384 }).toString(); break;
                    case 'SHA-3-512': hash = CryptoJS.SHA3(targetData, { outputLength: 512 }).toString(); break;
                    case 'RIPEMD-160': hash = CryptoJS.RIPEMD160(targetData).toString(); break;
                    default: hash = `ç®—æ³•${algo}æš‚ä¸æ”¯æŒ`;
                }
                // æ€è·¯1è½åœ°ï¼šâ– å…¨è§’ç²—é»‘å‰ç¼€+ç®—æ³•åï¼Œé†’ç›®æ˜“è¯†åˆ«ï¼Œtextareaå®Œç¾å…¼å®¹ï¼Œä¸å½±å“å¤åˆ¶
                hashResult += `â–  ${algo}:\n${hash}`;
                // æœ€åä¸€ä¸ªç®—æ³•ä¸åŠ å›è½¦ï¼Œé¿å…æœ«å°¾å†—ä½™
                if (index !== algos.length - 1) hashResult += '\n';
            });
            return hashResult;
        }

        // ========== æ–‡æœ¬å“ˆå¸Œï¼šå®æ—¶è®¡ç®—+è¦†ç›–æ—§ç»“æœï¼ˆå¤åŸæœ€åˆé€»è¾‘ï¼‰ ==========
        function calcTextHashRealTime() {
            const text = textInput.value.trim();
            if (!text) {
                textResult.value = 'è¯·è¾“å…¥æ–‡æœ¬ï¼Œå®æ—¶ç”Ÿæˆè§„æ•´å“ˆå¸Œç»“æœ...';
                return;
            }
            // ä»…ä¿ç•™è®¡ç®—æ—¶é—´+å“ˆå¸Œï¼Œæ— é‡å¤è¾“å…¥å†…å®¹
            const result = `ã€æ–‡æœ¬å“ˆå¸Œè®¡ç®—æ—¶é—´ã€‘ï¼š${new Date().toLocaleString()}\n=============================\n${calcSingleHash(text, true)}`;
            textResult.value = result;
        }
        // ç»‘å®šæ–‡æœ¬å®æ—¶è§¦å‘äº‹ä»¶
        textInput.addEventListener('input', calcTextHashRealTime);
        algoCheckboxes.forEach(box => box.addEventListener('change', calcTextHashRealTime));
        // åˆå§‹åŒ–æ–‡æœ¬ç»“æœ
        calcTextHashRealTime();

        // ========== æ–‡ä»¶å“ˆå¸Œï¼šæ— æ¼ç®—+é¡ºåºæ’åˆ—ï¼ˆä¿ç•™éœ€æ±‚1ä¿®å¤é€»è¾‘ï¼‰ ==========
        // 1. é€’å½’éå†æ–‡ä»¶å¤¹+ç²¾å‡†ç»Ÿè®¡çœŸå®æ–‡ä»¶æ•°
        async function traverseFolder(entry, path = '') {
            const fullPath = path ? `${path}/${entry.name}` : entry.name;
            if (entry.isFile) {
                return new Promise(resolve => entry.file(file => {
                    fileList.push({ path: fullPath, file });
                    newFileCount++; // æ¯æ‰¾åˆ°1ä¸ªæ–‡ä»¶ï¼Œè®¡æ•°+1ï¼Œç²¾å‡†ç»Ÿè®¡çœŸå®æ–‡ä»¶æ•°
                    resolve();
                }));
            }
            if (entry.isDirectory) {
                const reader = entry.createReader();
                return new Promise(resolve => {
                    const readEntries = () => reader.readEntries(entries => {
                        entries.length === 0 ? resolve() : Promise.all(entries.map(e => traverseFolder(e, fullPath))).then(readEntries);
                    });
                    readEntries();
                });
            }
        }

        // 2. å•æ–‡ä»¶å“ˆå¸Œè®¡ç®— + æ ¼å¼ä¸å˜
        async function calcSingleFileHash(fileObj) {
            const { path, file } = fileObj;
            return new Promise(resolve => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const hash = calcSingleHash(e.target.result, false);
                    const result = `ã€æ–‡ä»¶å“ˆå¸Œã€‘
æ–‡ä»¶è·¯å¾„ï¼š${path}
æ–‡ä»¶åç§°ï¼š${file.name}
æ–‡ä»¶å¤§å°ï¼š${(file.size / 1024).toFixed(2)} KB
=============================
${hash}
=========================================\n`;
                    resolve(result);
                };
                reader.readAsArrayBuffer(file);
            });
        }

        // 3. æ‰¹é‡è®¡ç®—ï¼šæç¤ºç´§è·Ÿå¯¹åº”æ‰¹æ¬¡å“ˆå¸Œç»“æœä¸‹æ–¹ï¼ˆé¡ºåºæ’åˆ—ï¼‰
        async function calcFileHashAuto() {
            if (newFileCount === 0 || fileList.length === 0) return;
            loading.style.display = 'block';
            // ç²¾å‡†æ‹¿åˆ°æœ¬æ¬¡æ‹–æ‹½çš„æ‰€æœ‰æ–°å¢æ–‡ä»¶ï¼Œæ— é—æ¼
            const batchStart = fileList.length - newFileCount;
            const newFiles = fileList.slice(batchStart);
            
            let newResult = '';
            // å…ˆåŠ æœ¬æ¬¡æ‰¹æ¬¡æç¤ºï¼Œå†åŠ å¯¹åº”æ–‡ä»¶å“ˆå¸Œç»“æœï¼Œè‡ªä¸Šè€Œä¸‹é¡ºåºæ’åˆ—
            newResult += `âœ… æ–°å¢${newFileCount}ä¸ªæ–‡ä»¶ï¼Œç´¯è®¡${fileList.length}ä¸ªæ–‡ä»¶\n\n`;
            for (const file of newFiles) {
                newResult += await calcSingleFileHash(file);
            }
            // è¿½åŠ åˆ°ç»“æœæœ«å°¾ï¼ŒæŒ‰æ‹–æ‹½é¡ºåºè‡ªä¸Šè€Œä¸‹è¡”æ¥ï¼Œä¸æ‰“ä¹±åŸæœ‰å†…å®¹
            fileResult.value += newResult;
            loading.style.display = 'none';
        }

        // 4. æ‹–æ‹½äº‹ä»¶ç»‘å®šï¼šè®¡æ•°é‡ç½®+é¡ºåºç´¯åŠ 
        dragArea.addEventListener('dragover', (e) => { e.preventDefault(); dragArea.classList.add('active'); });
        dragArea.addEventListener('dragleave', () => dragArea.classList.remove('active'));
        dragArea.addEventListener('drop', async (e) => {
            e.preventDefault();
            dragArea.classList.remove('active');
            const items = e.dataTransfer.items;
            if (!items.length) return;

            // æ¯æ¬¡æ‹–æ‹½å‰ï¼Œé‡ç½®æ–°å¢æ–‡ä»¶è®¡æ•°
            newFileCount = 0;
            const tempList = [];
            
            // éå†æ‰€æœ‰æ‹–æ‹½å…¥å£ï¼ˆæ–‡ä»¶/æ–‡ä»¶å¤¹ï¼‰ï¼Œé€’å½’è§£æ
            for (const item of items) {
                const entry = item.webkitGetAsEntry();
                if (entry) tempList.push(traverseFolder(entry));
            }
            // ç­‰å¾…æ‰€æœ‰æ–‡ä»¶è§£æå®Œæˆ+è®¡æ•°å®Œæˆï¼Œå†è®¡ç®—
            await Promise.all(tempList);
            
            // è‡ªåŠ¨è®¡ç®—æœ¬æ¬¡æ‰€æœ‰æ–°å¢æ–‡ä»¶ï¼Œæ— æ¼ç®—
            await calcFileHashAuto();
        });

        // ========== å…¨å±€æ“ä½œï¼šä¿ç•™2å¤§æ ¸å¿ƒéœ€æ±‚ï¼ˆæ¸…ç©ºä¸é‡ç½®ç®—æ³•+åŸç”Ÿå¼¹çª—3ç§’å…³ï¼‰ ==========
        copyAllBtn.addEventListener('click', async () => {
            const allResult = `=== æ–‡æœ¬å“ˆå¸Œç»“æœ ===\n${textResult.value}\n\n=== æ–‡ä»¶å“ˆå¸Œç»“æœ ===\n${fileResult.value}`;
            if (!allResult.trim()) return autoCloseAlert('æš‚æ— ç»“æœå¯å¤åˆ¶ï¼');
            await navigator.clipboard.writeText(allResult);
            autoCloseAlert('âœ… æ–‡æœ¬+æ–‡ä»¶æ‰€æœ‰å“ˆå¸Œç»“æœå·²å¤åˆ¶ï¼');
        });

        // éœ€æ±‚1è½åœ°ï¼šæ¸…ç©ºä»…æ¸…ç»“æœæ ï¼Œä¸é‡ç½®ç®—æ³•å‹¾é€‰
        clearAllBtn.addEventListener('click', () => {
            textInput.value = '';
            textResult.value = 'è¯·è¾“å…¥æ–‡æœ¬ï¼Œå®æ—¶ç”Ÿæˆè§„æ•´å“ˆå¸Œç»“æœ...';
            fileList = [];
            fileResult.value = 'æ–‡ä»¶å“ˆå¸Œç»“æœå°†æŒ‰æ‹–æ‹½é¡ºåºç´¯åŠ å±•ç¤ºåœ¨è¿™é‡Œ...';
            newFileCount = 0;
            calcTextHashRealTime();
            autoCloseAlert('âœ… å·²æ¸…ç©ºæ‰€æœ‰å“ˆå¸Œç»“æœï¼Œä¿ç•™ç®—æ³•å‹¾é€‰ï¼');
        });

        // åˆå§‹åŒ–æ–‡ä»¶ç»“æœæç¤º
        if (!fileResult.value.trim()) {
            fileResult.value = 'æ–‡ä»¶å“ˆå¸Œç»“æœå°†æŒ‰æ‹–æ‹½é¡ºåºç´¯åŠ å±•ç¤ºåœ¨è¿™é‡Œ...';
        }
    </script>
</body>
</html>